@php
    $dialogs = [
        'dialog1'=> [
            'id' => 'fri1',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => true,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'mine',
            'lastStatusRead' => 'false',
            'lastStatusSent' => 'false',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'recieved',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
        'dialog2'=> [
            'id' => 'fri2',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => false,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'notMine',
            'lastStatusRead' => 'true',
            'lastStatusSent' => 'true',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
        'dialog3'=> [
            'id' => 'new1',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => true,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'mine',
            'lastStatusRead' => 'true',
            'lastStatusSent' => 'true',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
        'dialog4'=> [
            'id' => 'new2',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => true,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'mine',
            'lastStatusRead' => 'false',
            'lastStatusSent' => 'false',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
        'dialog5'=>
            [
            'id' => 'gro1',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => true,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'notMine',
            'lastStatusRead' => 'true',
            'lastStatusSent' => 'true',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
        'dialog6'=> [
            'id' => 'gro2',
            'name' => 'Artem Jonson',
            'photo' => 'src/img/photo/nft/user1.jpg',
            'online' => false,
            'lastDate' => '13.02.2023',
            'lastTime' => '17:00',
            'lastMessage' => 'mine',
            'lastStatusRead' => 'false',
            'lastStatusSent' => 'true',
            'messages' => [
                'message1' => [
                    'id' => 1,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message2' => [
                    'id' => 2,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
                'message3' => [
                    'id' => 3,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. Seamlessly generate user friendly opportunitie after principle-centered e-markets. Proactively visualize functional',
                ],
                'message4' => [
                    'id' => 4,
                    'time' => '12:53',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Proactively visualize functional',
                ],
                'message5' => [
                    'id' => 5,
                    'time' => '17:00',
                    'date' => '13.02.2023',
                    'sender' => 'sent',
                    'content' => 'Monotonectally productivate virtual benefits vis-a-vis clicks-and-mortar lead ship. ',
                ],
            ],
        ],
    ]
@endphp

<x-base>
    <x-menu />

    <section class="messages">
        <x-header />

        <div class="messages__content d-flex flex-row">
            <div class="messages__filter flex-column align-items-center text-center">
                <div class="messages__filter__item active">
                    <div class="messages__filter__item__top">
                        <img src="{{ asset('src/img/icons/messages/all.svg')}}" alt="Image of the block of messages" class="messages__filter__item__top__img">

                        <div class="messages__filter__item__top__num d-flex justify-content-center align-items-center">
                            <p class="messages__filter__item__top__num__text">
                                2
                            </p>
                        </div>
                    </div>

                    <p class="messages__filter__item__title desc">
                        All <br> Messages
                    </p>
                </div>

                <div class="messages__filter__item">
                    <div class="messages__filter__item__top">
                        <img src="{{ asset('src/img/icons/messages/new.svg')}}" alt="Image of the block of messages" class="messages__filter__item__top__img">

                        <div class="messages__filter__item__top__num d-flex justify-content-center align-items-center">
                            <p class="messages__filter__item__top__num__text">
                                2
                            </p>
                        </div>
                    </div>

                    <p class="messages__filter__item__title desc">
                        New <br> Messages
                    </p>
                </div>

                <div class="messages__filter__item">
                    <div class="messages__filter__item__top">
                        <img src="{{ asset('src/img/icons/messages/user.svg')}}" alt="Image of the block of messages" class="messages__filter__item__top__img">

                        <div class="messages__filter__item__top__num d-flex justify-content-center align-items-center">
                            <p class="messages__filter__item__top__num__text">
                                2
                            </p>
                        </div>
                    </div>

                    <p class="messages__filter__item__title desc">
                        My <br> Friends
                    </p>
                </div>

                <div class="messages__filter__item">
                    <div class="messages__filter__item__top">
                        <img src="{{ asset('src/img/icons/messages/group.svg')}}" alt="Image of the block of messages" class="messages__filter__item__top__img">

                        <div class="messages__filter__item__top__num d-flex justify-content-center align-items-center">
                            <p class="messages__filter__item__top__num__text">
                                2
                            </p>
                        </div>
                    </div>

                    <p class="messages__filter__item__title desc">
                        Group <br> Messages
                    </p>
                </div>

                <div class="messages__filter__item">
                    <div class="messages__filter__item__top">
                        <img src="{{ asset('src/img/icons/messages/settings.svg')}}" alt="Image of the block of messages" class="messages__filter__item__top__img">

                        <div class="messages__filter__item__top__num d-flex justify-content-center align-items-center">
                            <p class="messages__filter__item__top__num__text">
                                2
                            </p>
                        </div>
                    </div>

                    <p class="messages__filter__item__title desc">
                        Support <br> team
                    </p>
                </div>
            </div>

            <div class="messages__dialogs">
                <div class="messages__dialogs__top d-flex flex-row align-items-center justify-content-between">
                    <h3 class="messages__dialogs__top__title title-little">
                        My Messages
                    </h3>

                    <div class="messages__dialogs__top__btns d-flex flex-row align-items-center">
                      <a href="#" class="messages__dialogs__top__btns__search">
                          <img src="{{ asset('src/img/icons/search.svg')}}" alt="Search" class="messages__dialogs__top__search__img">
                      </a>

                      <a href="#" class="messages__dialogs__top__btns__add">
                          <img src="{{ asset('src/img/icons/messages/add.svg')}}" alt="Add" class="messages__dialogs__top__add__img">
                      </a>
                    </div>
                </div>

                <div class="messages__dialogs__block">
                    @foreach($dialogs as $dialog)
                        <div class="messages__dialogs__item d-flex flex-row align-items-center" data-dialog-id="{{ $dialog['id']}}">
                            <div class="messages__dialogs__item__photo">
                                <img src="{{ asset($dialog['photo'])}}" alt="Photo" class="messages__dialogs__item__photo__img">

                                @if($dialog['online'] === true)
                                    <div class="messages__dialogs__item__photo__status messages__dialogs__item__photo__status--true"></div>
                                @elseif($dialog['online'] === false)
                                    <div class="messages__dialogs__item__photo__status messages__dialogs__item__photo__status--false"></div>
                                @endif
                            </div>

                            <div class="messages__dialogs__item__content d-flex flex-row align-items-center justify-content-between">
                                <div class="messages__dialogs__item__content__top d-flex flex-column justify-content-between">
                                    <h4 class="messages__dialogs__item__content__top__name title-little">
                                        {{ $dialog['name']}}
                                    </h4>

                                    <p class="messages__dialogs__item__content__top__text desc">
                                        @php
                                            $latestMessage = null;
                                            $latestId = null;
                                        @endphp

                                        @foreach ($dialog['messages'] as $message)
                                            @if ($message['time'] === $dialog['lastTime'] && ($latestId === null || $message['id'] > $latestId))
                                                @php
                                                    $latestMessage = $message['content'];
                                                    $latestId = $message['id'];
                                                @endphp
                                            @endif
                                        @endforeach

                                        {{ $latestMessage }}
                                    </p>
                                </div>

                                    <div class="messages__dialogs__item__content__bottom d-flex flex-column justify-content-between align-items-end">
                                        <p class="messages__dialogs__item__content__bottom__time desc">
                                            {{ $dialog['lastTime']}}
                                        </p>

                                        @if($dialog['lastMessage'] === 'mine' && $dialog['lastStatusSent'] === 'false')
                                            <img
                                                src="{{ asset('src/img/icons/messages/status/unsent.svg')}}"
                                                alt="Not sent"
                                                class="messages__dialogs__item__content__bottom__check"
                                            >
                                        @elseif($dialog['lastMessage'] === 'mine' && $dialog['lastStatusSent'] === 'true' && $dialog['lastStatusRead'] === 'false')
                                            <img
                                                src="{{ asset('src/img/icons/messages/status/unread.svg')}}"
                                                alt="Not read"
                                                class="messages__dialogs__item__content__bottom__check"
                                            >
                                        @elseif($dialog['lastMessage'] === 'mine' && $dialog['lastStatusSent'] === 'true' && $dialog['lastStatusRead'] === 'true')
                                            <img
                                                src="{{ asset('src/img/icons/messages/status/read.svg')}}"
                                                alt="Read"
                                                class="messages__dialogs__item__content__bottom__check"
                                            >
                                        @endif
                                </div>
                            </div>
                        </div>
                    @endforeach
                </div>
            </div>

            <div class="messages__chat flex-column">
                <div class="messages__chat__top d-flex flex-row justify-content-between">
                    <div class="messages__chat__top__right d-flex flex-row">
                        <img src="{{ asset('src/img/icons/messages/photo-default.png')}}" alt="User photo" class="messages__chat__top__img">

                        <div class="messages__chat__top__info d-flex flex-column justify-content-between">
                            <p class="messages__chat__top__info__name title-little">

                            </p>

                            <p class="messages__chat__top__info__status desc">

                            </p>
                        </div>
                    </div>

                    <div class="messages__chat__top__btns d-flex flex-row align-items-center justify-content-center">
                        <a href="#" class="messages__chat__top__btns__search">
                            <img src="{{ asset('src/img/icons/search.svg')}}" alt="Search" class="messages__dialogs__top__search__img">
                        </a>

                        <a href="#" class="messages__chat__top__btns__options">
                            <img src="{{ asset('src/img/icons/messages/options.svg')}}" alt="Options" class="messages__dialogs__top__search__img">
                        </a>
                    </div>
                </div>

                <div class="messages__chat__block">
                    <div class="d-flex justify-content-center align-items-center">
                        <h3 class="messages__chat__block__default title-little">
                            Your messages will be here
                        </h3>
                    </div>
                </div>

                <div class="messages__chat__new d-flex flex-row align-items-center justify-content-between">
                    <div class="messages__chat__new__wrap">
                        <div class="messages__chat__new__wrap__search">
                            <input
                                type="text"
                                class="messages__chat__new__wrap__search__input desc"
                                placeholder="To write a message..."
                            >

                            <div class="messages__chat__new__wrap__search__btns">
                                <button type="submit" class="messages__chat__new__wrap__search__btn">
                                    <img src="{{ asset('src/img/icons/messages/plus.svg')}}" alt="Add file">
                                </button>

                                <button type="submit" class="messages__chat__new__wrap__search__btn">
                                    <img src="{{ asset('src/img/icons/messages/smile.svg')}}" alt="Add smile">
                                </button>
                            </div>
                        </div>
                    </div>

                    <button
                        type="submit"
                        class="
                            complete__btn
                            messages__chat__new__btn--desk
                            flex-row
                            align-items-center
                            button
                        "
                        style="
                            gap: 15px;
                            font-size: 16px;
                            width: 132px;
                        "
                    >
                        <img
                            src="{{asset('src/img/icons/messages/send.svg')}}"
                            alt="Send message"
                            class="complete__btn__img"
                            style="
                                padding: 12px;
                            "
                        >

                        Send
                    </button>

                    <button
                        type="submit"
                        class="
                            messages__chat__new__btn--mob
                        "
                    >
                        <img
                            src="{{asset('src/img/icons/messages/send.svg')}}"
                            alt="Send message"
                            class="messages__chat__new__btn--mob__img"
                        >
                    </button>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const chatDiv = document.querySelector(".messages__chat");
            const dialogsDiv = document.querySelector(".messages__dialogs");
            const filterDiv = document.querySelector(".messages__filter");

            const dialogItems = document.querySelectorAll(".messages__dialogs__item");
            const chatBlock = document.querySelector(".messages__chat__block");
            const chatName = document.querySelector(".messages__chat__top__info__name");
            const chatStatus = document.querySelector(".messages__chat__top__info__status");
            const chatPhoto = document.querySelector(".messages__chat__top__img");

            <?php echo "const dialogs = " . json_encode($dialogs) . ";" ?>

            dialogItems.forEach(dialogItem => {
                dialogItem.addEventListener("click", function () {
                    // Clear existing messages in the chat block
                    chatBlock.innerHTML = "";

                    // Retrieve dialog ID from the clicked item
                    const dialogId = dialogItem.dataset.dialogId;
                    let messages;

                    if (window.innerWidth <= 1300) {
                        chatDiv.style.display = 'block';
                        dialogsDiv.style.display = 'none';
                        filterDiv.style.display = 'none';
                    }

                    for (const key in dialogs) {
                        if (Object.hasOwnProperty.call(dialogs, key)) {
                            const dialog = dialogs[key];
                            if (dialog.id === dialogId) {
                                messages = dialog.messages;

                                // Update chat name with the dialog's name
                                chatName.textContent = dialog.name;
                                chatPhoto.src = dialog.photo;

                                // Update chat status based on dialog's online status
                                if (dialog.online) {
                                    chatStatus.textContent = "Online";
                                    chatStatus.classList.add('true');
                                    chatStatus.classList.remove('false');
                                } else {
                                    chatStatus.textContent = "Offline";
                                    chatStatus.classList.add('false');
                                    chatStatus.classList.remove('true');
                                }

                                break;
                            }
                        }
                    }

                    // Populate the chat block with messages
                    let currentSender;
                    let currentMessageBlock;

                    Object.values(messages).forEach(message => {
                        if (currentSender !== message.sender) {
                            // Create a new message block for a new sender
                            currentSender = message.sender;
                            currentMessageBlock = document.createElement("div");
                            currentMessageBlock.classList.add("messages__chat__block__item", message.sender);
                            chatBlock.appendChild(currentMessageBlock);
                        }

                        const messageDiv = document.createElement("div");
                        messageDiv.classList.add("messages__chat__block__item__text");
                        messageDiv.innerHTML = `
                            <p class="messages__chat__block__item__text__content desc">${message.content}</p>
                        `;
                        currentMessageBlock.appendChild(messageDiv);
                    });
                });
            });
        });
    </script>
</x-base>
